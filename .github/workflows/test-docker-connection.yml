name: üîç Test Docker Hub Connection

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  check-docker-secrets:
    runs-on: ubuntu-latest
    steps:
    - name: üìã Check Docker Hub Secrets Status
      run: |
        echo "=================================================="
        echo "üîç DOCKER HUB SECRETS VERIFICATION"
        echo "=================================================="
        echo ""
        
        if [ -z "${{ secrets.DOCKER_USERNAME }}" ]; then
          echo "‚ùå DOCKER_USERNAME secret is NOT SET"
          echo "   ‚Üí Go to: https://github.com/${{ github.repository }}/settings/secrets/actions"
          echo "   ‚Üí Add secret: DOCKER_USERNAME = baffoe6"
        else
          echo "‚úÖ DOCKER_USERNAME secret is SET"
        fi
        
        if [ -z "${{ secrets.DOCKER_PASSWORD }}" ]; then
          echo "‚ùå DOCKER_PASSWORD secret is NOT SET"
          echo "   ‚Üí Go to: https://github.com/${{ github.repository }}/settings/secrets/actions"
          echo "   ‚Üí Add secret: DOCKER_PASSWORD = [your Docker Hub token]"
        else
          echo "‚úÖ DOCKER_PASSWORD secret is SET"
        fi
        
        echo ""
        if [ -n "${{ secrets.DOCKER_USERNAME }}" ] && [ -n "${{ secrets.DOCKER_PASSWORD }}" ]; then
          echo "üéâ Both secrets are configured! Testing Docker Hub login..."
        else
          echo "‚ö†Ô∏è  Please set up the missing secrets before continuing."
          echo "üìñ Instructions: https://github.com/${{ github.repository }}/blob/main/SETUP_CHECKLIST.txt"
        fi

  test-docker-login:
    runs-on: ubuntu-latest
    needs: check-docker-secrets
    if: ${{ secrets.DOCKER_USERNAME != '' && secrets.DOCKER_PASSWORD != '' }}
    steps:
    - name: üîê Test Docker Hub Login
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
    
    - name: üéâ Login Success
      run: |
        echo "=================================================="
        echo "‚úÖ SUCCESS! Docker Hub login working perfectly!"
        echo "=================================================="
        echo ""
        echo "Your CI/CD pipeline will now be able to:"
        echo "‚Ä¢ Build Docker images"
        echo "‚Ä¢ Push to Docker Hub as:"
        echo "  - baffoe6/users-service:latest"
        echo "  - baffoe6/products-service:latest"
        echo "‚Ä¢ Run security scans with Trivy"
        echo ""
        echo "üöÄ Ready to run the full CI/CD pipeline!"
